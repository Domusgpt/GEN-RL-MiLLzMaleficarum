<<<<<<< HEAD
document.addEventListener('DOMContentLoaded',()=>{fetchMagazineData();});async function fetchMagazineData(){const apiUrl='/api/current-data';try{const response=await fetch(apiUrl);if(!response.ok)throw new Error(`HTTP error! Status: ${response.status}`);const magazineData=await response.json();renderMagazine(magazineData);}catch(error){console.error("Fetch Error:",error);displayLoadError();}}
function renderMagazine(magazineData){console.log("Render Cycle:",magazineData.cycleNumber);setTextContent('#cycle-number',magazineData.cycleNumber);setTextContent('#transmission-date',magazineData.transmissionDate);setTextContent('#year',new Date().getFullYear());setTextContent('#footer-mantra',magazineData.footerMantra);const mainGrid=document.querySelector('.content-grid');if(mainGrid){mainGrid.innerHTML='';document.querySelectorAll('.content-module.has-visual-focus').forEach(el=>el.classList.remove('has-visual-focus'));const layoutConfig=magazineData.layoutConfiguration||{};applyLayoutTemplate(layoutConfig.templateName);let modulesToRender=getOrderedModules(magazineData.mainContent,layoutConfig.moduleOrder);modulesToRender.forEach((item,index)=>{const moduleElement=createContentModuleElement(item,index);if(moduleElement){if(item.id&&layoutConfig.featuredVisualTargetId===item.id){moduleElement.classList.add('has-visual-focus');}mainGrid.appendChild(moduleElement);}});}else{console.error("Grid not found.");}applyStyleOverrides(magazineData.styleOverrides);document.documentElement.classList.remove('no-js');document.documentElement.classList.add('js-ready');}
function applyLayoutTemplate(templateName='standard-grid'){document.body.className='';document.body.classList.add(templateName);console.log(`Layout: ${templateName}`);}
function getOrderedModules(content,orderArray){if(!orderArray||!Array.isArray(orderArray)||orderArray.length!==content.length){return content;}try{const contentMap=new Map(content.map(item=>[item.id,item]));const orderedContent=orderArray.map(id=>contentMap.get(id)).filter(item=>item!==undefined);return(orderedContent.length===content.length)?orderedContent:content;}catch(e){console.error("Order err:",e);return content;}}
function createContentModuleElement(item,index){const section=document.createElement('section');section.id=item.id||`module-${index}-${Date.now()}`;section.className=`content-module ${item.type}-module animate-entrance`;section.style.animationDelay=`calc(var(--entrance-delay, 0.1s) * ${index+1})`;let title='';let bodyContent='';let isHolographic=false;let isSmall=false;switch(item.type){case 'directive':title=item.title||'// DIRECTIVE //';bodyContent=item.content||'<p>...</p>';isHolographic=true;section.classList.add('holographic-panel');break;case 'article':title=item.title||'// ARCHIVE //';bodyContent=item.content||'<p>...</p>';break;case 'letter':title=`// FROM: ${item.sender||'UNKNOWN'} //`;bodyContent=item.content||'<p>...</p>';break;case 'cipher':title=item.title||'// ENCRYPTED //';bodyContent=`<div class="cipher-text">${item.content||'...'}</div>`;if(item.decryptionHint)bodyContent+=`<p class="cipher-hint">Hint: ${item.decryptionHint}</p>`;isHolographic=true;isSmall=true;section.classList.add('holographic-panel','small-module');break;default:title=`// UNKNOWN: ${item.type} //`;bodyContent=`<p>Unrecognized.</p>`;}section.innerHTML=`<h2 class="section-title">${title}</h2><div class="module-body">${bodyContent}</div> ${isHolographic?`<div class="panel-corner corner-tl"></div><div class="panel-corner corner-tr"></div><div class="panel-corner corner-br"></div><div class="panel-corner corner-bl"></div><div class="panel-scanline ${isSmall?'intense':''}"></div>`:''}`;return section;}
function applyStyleOverrides(styleOverrides){if(styleOverrides){const root=document.documentElement;for(const[variable,value]of Object.entries(styleOverrides)){if(variable.startsWith('--')){root.style.setProperty(variable,value);}}}}
function setTextContent(selector,text){const element=document.querySelector(selector);if(element)element.textContent=text??'';}
function displayLoadError(){const grid=document.querySelector('.content-grid');if(grid)grid.innerHTML=`<p class="error-message">SIGNAL LOST.</p>`;const style=document.createElement('style');style.textContent='.error-message{color:red;font-weight:bold;text-align:center;margin-top:50px;}';document.head.appendChild(style);}
=======
// script.js - Handles dynamic content, style injection, and visual focus
document.addEventListener('DOMContentLoaded',()=>{fetchMagazineData();});async function fetchMagazineData(){const apiUrl='/api/current-data';try{const response=await fetch(apiUrl);if(!response.ok)throw new Error(`HTTP error! Status: ${response.status}`);const magazineData=await response.json();renderMagazine(magazineData);}catch(error){console.error("Failed to fetch magazine data:",error);displayLoadError();}}
function renderMagazine(magazineData){console.log("Rendering Cycle:",magazineData.cycleNumber);setTextContent('#cycle-number',magazineData.cycleNumber);setTextContent('#transmission-date',magazineData.transmissionDate);setTextContent('#year',new Date().getFullYear());setTextContent('#footer-mantra',magazineData.footerMantra);const mainGrid=document.querySelector('.content-grid');if(mainGrid){mainGrid.innerHTML='<p class="placeholder-module">Processing Transmission...</p>';document.querySelectorAll('.content-module.has-visual-focus').forEach(el=>el.classList.remove('has-visual-focus'));const layoutConfig=magazineData.layoutConfiguration||{};applyLayoutTemplate(layoutConfig.templateName);let modulesToRender=getOrderedModules(magazineData.mainContent,layoutConfig.moduleOrder);mainGrid.innerHTML='';modulesToRender.forEach((item,index)=>{const moduleElement=createContentModuleElement(item,index);if(moduleElement){if(item.id&&layoutConfig&&layoutConfig.featuredVisualTargetId===item.id){moduleElement.classList.add('has-visual-focus');}
mainGrid.appendChild(moduleElement);}});applyStyleOverrides(magazineData.styleOverrides);document.documentElement.classList.remove('no-js');document.documentElement.classList.add('js-ready');}else{console.error("Main content grid container not found.");}}
function applyLayoutTemplate(templateName='standard-grid'){document.body.className='';document.body.classList.add(templateName||'standard-grid');console.log(`Applying layout template: ${templateName||'standard-grid'}`);}
function getOrderedModules(content,orderArray){if(!orderArray||!Array.isArray(orderArray)||orderArray.length===0){console.log("Using default module order (no valid order array).");return content;}try{const contentMap=new Map(content.map(item=>[item.id,item]));const validOrderIds=orderArray.filter(id=>contentMap.has(id));if(validOrderIds.length!==content.length){console.warn(`Module order array length (${orderArray.length}) or IDs don't match content length (${content.length}). Using default order.`);return content;}
const orderedContent=validOrderIds.map(id=>contentMap.get(id));console.log("Applying custom module order.");return orderedContent;}catch(e){console.error("Error applying module order:",e);return content;}}
function createContentModuleElement(item,index){const section=document.createElement('section');section.id=item.id||`module-${index}-${Date.now()}`;section.className=`content-module ${item.type}-module animate-entrance`;section.style.animationDelay=`calc(var(--entrance-delay, 0.1s) * ${index+1})`;let title='';let bodyContent='';let isHolographic=false;let isSmall=false;switch(item.type){case'directive':title=item.title||'// DIRECTIVE //';bodyContent=item.content||'<p>...</p>';isHolographic=true;section.classList.add('holographic-panel');break;case'article':title=item.title||'// ARCHIVE //';bodyContent=item.content||'<p>...</p>';break;case'letter':title=`// FROM: ${item.sender||'UNIT'} //`;bodyContent=item.content||'<p>...</p>';break;case'cipher':title=item.title||'// ENCRYPTED //';bodyContent=`<div class="cipher-text">${item.content||'...'}</div>`;if(item.decryptionHint)bodyContent+=`<p class="cipher-hint">Hint: ${item.decryptionHint}</p>`;isHolographic=true;isSmall=true;section.classList.add('holographic-panel','small-module');break;default:title=`// TYPE UNKNOWN: ${item.type} //`;bodyContent=`<p>Format unrecognized.</p>`;}
const titleElement=document.createElement('h2');titleElement.className='section-title';titleElement.textContent=title;const bodyElement=document.createElement('div');bodyElement.className='module-body';bodyElement.innerHTML=bodyContent;section.appendChild(titleElement);section.appendChild(bodyElement);if(isHolographic){const corners=`<div class="panel-corner corner-tl"></div><div class="panel-corner corner-tr"></div><div class="panel-corner corner-br"></div><div class="panel-corner corner-bl"></div>`;const scanline=`<div class="panel-scanline ${isSmall?'intense':''}"></div>`;section.insertAdjacentHTML('beforeend',corners+scanline);}
return section;}
function applyStyleOverrides(styleOverrides){if(styleOverrides){const root=document.documentElement;for(const[variable,value]of Object.entries(styleOverrides)){if(variable.startsWith('--')){root.style.setProperty(variable,value);}}}}
function setTextContent(selector,text){const element=document.querySelector(selector);if(element)element.textContent=text??'';}
function displayLoadError(){const grid=document.querySelector('.content-grid');if(grid)grid.innerHTML=`<p class="error-message">SIGNAL LOST. Cannot load transmission data.</p>`;const style=document.createElement('style');style.textContent='.error-message{color:#ff5555;font-weight:bold;text-align:center;margin-top:50px;}';document.head.appendChild(style);}
>>>>>>> origin/main
